<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Donor Directory</title>
    <style>
        /* 1. Base (Mobile-First) Styling */
        body { 
            font-family: Arial, sans-serif; 
            background: #f9f9f9; 
            padding: 10px; 
        }
        .donor-container { 
            max-width: 800px; 
            margin: 10px auto; 
            background: white; 
            padding: 15px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        }
        h2 { 
            text-align: center; 
            color: #d9534f; 
            border-bottom: 2px solid #eee; 
            padding-bottom: 8px; 
            font-size: 20px; 
        }
        
        /* Dropdown Styling */
        .filter-area { margin-bottom: 20px; text-align: center; }
        .blood-group-select {
            width: 95%; 
            max-width: 300px;
            padding: 10px;
            border: 2px solid #d9534f;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        
        /* Table Responsiveness */
        .table-responsive {
            overflow-x: auto;
            width: 100%;
        }
        #donorTable {
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 15px; 
            display: none;
            /* No min-width needed now, as we hide one column */
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 8px; 
            text-align: left; 
            white-space: nowrap; 
        }
        th { background: #d9534f; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        
        /* *** HIDE ADDRESS COLUMN ON PHONES (Mobile-First) *** */
        .address-column { 
            display: none; 
        }

        /* 2. Desktop Adjustments (Media Query) */
        @media (min-width: 600px) {
            /* Show the Address column on screens 600px and wider */
            .address-column {
                display: table-cell !important; /* Force it to display */
            }
            body { padding: 20px; }
            .donor-container { padding: 30px; margin: 20px auto; }
            h2 { font-size: 24px; }
            th, td { padding: 10px; }
        }
        
        /* Message Styling */
        #errorMessage { color: #5cb85c; font-weight: bold; text-align: center; margin-top: 15px; }
        #loadingMessage { text-align: center; color: #777; margin-top: 20px; }
    </style>
</head>
<body>

<div class="donor-container">
    <h2>ðŸ©¸ Blood Donor Directory (Live Filter)</h2>

    <div class="filter-area">
        <label for="bloodGroupSelector" style="display: block; margin-bottom: 10px; font-weight: bold;">
            Select Required Blood Group:
        </label>
        <select id="bloodGroupSelector" class="blood-group-select">
            <option value="" selected disabled>-- Select Blood Group --</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
        </select>
    </div>

    <p id="loadingMessage">Loading donor data...</p>
    <p id="errorMessage"></p>

    <div class="table-responsive">
        <table id="donorTable" style="display: none;">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Blood Group</th>
                    <th>Contact</th>
                    <th class="address-column">Address</th> </tr>
            </thead>
            <tbody id="donorBody">
                </tbody>
        </table>
    </div>

</div>

<script>
let donorData = [];
// This is your Donor List URL, similar to the one you provided earlier, but set to output CSV.
const donorCsvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQju7JjcIDH-Y_wUuxhvL5MUzkN24Atz85B8uUBJd5SwUCwVKKjRLcpkK7gNNwmcsSb48r-Jpqu4kjl/pub?output=csv";

async function fetchDonorData() {
    const proxy = "https://corsproxy.io/?"; 
    
    try {
        const response = await fetch(proxy + donorCsvUrl);
        const text = await response.text();
        
        // CSV parsing: assumes Name, Blood Group, Contact, Address are in columns A, B, C, D
        const rows = text.trim().split('\n').map(r => r.split(','));

        // Store data starting from the second row (skipping headers)
        donorData = rows.slice(1).map(row => {
            const entry = {};
            entry.Name = row[0] ? row[0].trim() : "N/A";
            entry.BloodGroup = row[1] ? row[1].trim() : "N/A"; 
            entry.Contact = row[2] ? row[2].trim() : "N/A";
            entry.Address = row[3] ? row[3].trim() : "N/A";
            return entry;
        });

        document.getElementById("loadingMessage").style.display = 'none';
        
    } catch (err) {
        document.getElementById("loadingMessage").textContent = "Failed to load donor data. Please check the sheet's publish settings.";
        console.error("Fetch error:", err);
    }
}

function filterAndDisplayDonors(bloodGroup) {
    const table = document.getElementById("donorTable");
    const tbody = document.getElementById("donorBody");
    tbody.innerHTML = ''; 

    if (!bloodGroup) {
        table.style.display = 'none'; 
        return;
    }
    
    const matches = donorData.filter(donor => donor.BloodGroup === bloodGroup);

    table.style.display = 'table';
    
    if (matches.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4">No donors found for the selected blood group.</td></tr>`;
        return;
    }

    // Pass the Address to the row, but the CSS will control visibility
    const rows = matches.map(donor => `
        <tr>
            <td>${donor.Name}</td>
            <td>${donor.BloodGroup}</td>
            <td>${donor.Contact}</td>
            <td class="address-column">${donor.Address}</td> </tr>
    `).join('');

    tbody.innerHTML = rows;
}

// Event Listeners (Triggers the filter on selection)
window.addEventListener('DOMContentLoaded', () => {
    fetchDonorData();

    const selector = document.getElementById("bloodGroupSelector");
    
    selector.selectedIndex = 0; 
    
    selector.addEventListener("change", function() {
        const selectedGroup = this.value;
        filterAndDisplayDonors(selectedGroup);
    });
});
</script>

</body>
</html>